#include <stdlib.h>
#include <string.h>
#include "formats/img.h"
#include "formats/libattopng.h"

static const uint32_t palette_1[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xffccffff, 0xff99ffff, 0xff66ffff, 0xff33ffff, 0xffffccff, 0xffccccff, 0xff99ccff, 0xff66ccff,
        0xff33ccff, 0xff00ccff, 0xffff99ff, 0xffcc99ff, 0xff9999ff, 0xff6699ff, 0xff3399ff, 0xff0099ff, 0xffff66ff,
        0xffcc66ff, 0xff9966ff, 0xff6666ff, 0xff3366ff, 0xff0066ff, 0xffff33ff, 0xffcc33ff, 0xff9933ff, 0xff6633ff,
        0xff3333ff, 0xff0033ff, 0xffcc00ff, 0xff9900ff, 0xff6600ff, 0xff3300ff, 0xffffffcc, 0xffccffcc, 0xff99ffcc,
        0xff66ffcc, 0xff33ffcc, 0xff00ffcc, 0xffffcccc, 0xffcccccc, 0xff99cccc, 0xff66cccc, 0xff33cccc, 0xff00cccc,
        0xffff99cc, 0xffcc99cc, 0xff9999cc, 0xff6699cc, 0xff3399cc, 0xff0099cc, 0xffff66cc, 0xffcc66cc, 0xff9966cc,
        0xff6666cc, 0xff3366cc, 0xff0066cc, 0xffff33cc, 0xffcc33cc, 0xff9933cc, 0xff6633cc, 0xff3333cc, 0xff0033cc,
        0xffff00cc, 0xffcc00cc, 0xff9900cc, 0xff6600cc, 0xff3300cc, 0xff0000cc, 0xffffff99, 0xffccff99, 0xff99ff99,
        0xff66ff99, 0xff33ff99, 0xff00ff99, 0xffffcc99, 0xffcccc99, 0xff99cc99, 0xff66cc99, 0xff33cc99, 0xff00cc99,
        0xffff9999, 0xffcc9999, 0xff999999, 0xff669999, 0xff339999, 0xff009999, 0xffff6699, 0xffcc6699, 0xff996699,
        0xff666699, 0xff336699, 0xff006699, 0xffff3399, 0xffcc3399, 0xff993399, 0xff663399, 0xff333399, 0xff003399,
        0xffff0099, 0xffcc0099, 0xff990099, 0xff660099, 0xff330099, 0xff000099, 0xffffff66, 0xffccff66, 0xff99ff66,
        0xff66ff66, 0xff33ff66, 0xff00ff66, 0xffffcc66, 0xffcccc66, 0xff99cc66, 0xff66cc66, 0xff33cc66, 0xff00cc66,
        0xffff9966, 0xffcc9966, 0xff999966, 0xff669966, 0xff339966, 0xff009966, 0xffff6666, 0xffcc6666, 0xff996666,
        0xff666666, 0xff336666, 0xff006666, 0xffff3366, 0xffcc3366, 0xff993366, 0xff663366, 0xff333366, 0xff003366,
        0xffff0066, 0xffcc0066, 0xff990066, 0xff660066, 0xff330066, 0xff000066, 0xffffff33, 0xffccff33, 0xff99ff33,
        0xff66ff33, 0xff33ff33, 0xff00ff33, 0xffffcc33, 0xffcccc33, 0xff99cc33, 0xff66cc33, 0xff33cc33, 0xff00cc33,
        0xffff9933, 0xffcc9933, 0xff999933, 0xff669933, 0xff339933, 0xff009933, 0xffff6633, 0xffcc6633, 0xff996633,
        0xff666633, 0xff336633, 0xff006633, 0xffff3333, 0xffcc3333, 0xff993333, 0xff663333, 0xff333333, 0xff003333,
        0xffff0033, 0xffcc0033, 0xff990033, 0xff660033, 0xff330033, 0xff000033, 0xffccff00, 0xff99ff00, 0xff66ff00,
        0xff33ff00, 0xffffcc00, 0xffcccc00, 0xff99cc00, 0xff66cc00, 0xff33cc00, 0xff00cc00, 0xffff9900, 0xffcc9900,
        0xff999900, 0xff669900, 0xff339900, 0xff009900, 0xffff6600, 0xffcc6600, 0xff996600, 0xff666600, 0xff336600,
        0xff006600, 0xffff3300, 0xffcc3300, 0xff993300, 0xff663300, 0xff333300, 0xff003300, 0xffcc0000, 0xff990000,
        0xff660000, 0xff330000, 0xff0000ee, 0xff0000dd, 0xff0000bb, 0xff0000aa, 0xff000077, 0xff000044, 0xff00ee00,
        0xff00dd00, 0xff00bb00, 0xff00aa00, 0xff007700, 0xff004400, 0xffee0000, 0xffdd0000, 0xffbb0000, 0xffaa0000,
        0xff770000, 0xff440000, 0xffeeeeee, 0xffdddddd, 0xffbbbbbb, 0xffaaaaaa, 0xff888888, 0xff777777, 0xff555555,
        0xff444444, 0xff222222, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t palette_2[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xffccffff, 0xff99ffff, 0xff66ffff, 0xff33ffff, 0xffffccff, 0xffccccff, 0xff99ccff, 0xff66ccff,
        0xff33ccff, 0xff00ccff, 0xffff99ff, 0xffcc99ff, 0xff9999ff, 0xff6699ff, 0xff3399ff, 0xff0099ff, 0xffff66ff,
        0xffcc66ff, 0xff9966ff, 0xff6666ff, 0xff3366ff, 0xff0066ff, 0xffff33ff, 0xffcc33ff, 0xff9933ff, 0xff6633ff,
        0xff3333ff, 0xff0033ff, 0xffcc00ff, 0xff9900ff, 0xff6600ff, 0xff3300ff, 0xffffffcc, 0xffccffcc, 0xff99ffcc,
        0xff66ffcc, 0xff33ffcc, 0xff00ffcc, 0xffffcccc, 0xffcccccc, 0xff99cccc, 0xff66cccc, 0xff33cccc, 0xff00cccc,
        0xffff99cc, 0xffcc99cc, 0xff9999cc, 0xff6699cc, 0xff3399cc, 0xff0099cc, 0xffff66cc, 0xffcc66cc, 0xff9966cc,
        0xff6666cc, 0xff3366cc, 0xff0066cc, 0xffff33cc, 0xffcc33cc, 0xff9933cc, 0xff6633cc, 0xff3333cc, 0xff0033cc,
        0xffff00cc, 0xffcc00cc, 0xff9900cc, 0xff6600cc, 0xff3300cc, 0xff0000cc, 0xffffff99, 0xffccff99, 0xff99ff99,
        0xff66ff99, 0xff33ff99, 0xff00ff99, 0xffffcc99, 0xffcccc99, 0xff99cc99, 0xff66cc99, 0xff33cc99, 0xff00cc99,
        0xffff9999, 0xffcc9999, 0xff999999, 0xff669999, 0xff339999, 0xff009999, 0xffff6699, 0xffcc6699, 0xff996699,
        0xff666699, 0xff336699, 0xff006699, 0xffff3399, 0xffcc3399, 0xff993399, 0xff663399, 0xff333399, 0xff003399,
        0xffff0099, 0xffcc0099, 0xff990099, 0xff660099, 0xff330099, 0xff000099, 0xffffff66, 0xffccff66, 0xff99ff66,
        0xff66ff66, 0xff33ff66, 0xff00ff66, 0xffffcc66, 0xffcccc66, 0xff99cc66, 0xff66cc66, 0xff33cc66, 0xff00cc66,
        0xffff9966, 0xffcc9966, 0xff999966, 0xff669966, 0xff339966, 0xff009966, 0xffff6666, 0xffcc6666, 0xff996666,
        0xff666666, 0xff336666, 0xff006666, 0xffff3366, 0xffcc3366, 0xff993366, 0xff663366, 0xff333366, 0xff003366,
        0xffff0066, 0xffcc0066, 0xff990066, 0xff660066, 0xff330066, 0xff000066, 0xffffff33, 0xffccff33, 0xff99ff33,
        0xff66ff33, 0xff33ff33, 0xff00ff33, 0xffffcc33, 0xffcccc33, 0xff99cc33, 0xff66cc33, 0xff33cc33, 0xff00cc33,
        0xffff9933, 0xffcc9933, 0xff999933, 0xff669933, 0xff339933, 0xff009933, 0xffff6633, 0xffcc6633, 0xff996633,
        0xff666633, 0xff336633, 0xff006633, 0xffff3333, 0xffcc3333, 0xff993333, 0xff663333, 0xff333333, 0xff003333,
        0xffff0033, 0xffcc0033, 0xff990033, 0xff660033, 0xff330033, 0xff000033, 0xffccff00, 0xff99ff00, 0xff66ff00,
        0xff33ff00, 0xffffcc00, 0xffcccc00, 0xff99cc00, 0xff66cc00, 0xff33cc00, 0xff00cc00, 0xffff9900, 0xffcc9900,
        0xff999900, 0xff669900, 0xff339900, 0xff009900, 0xffff6600, 0xffcc6600, 0xff996600, 0xff666600, 0xff336600,
        0xff006600, 0xffff3300, 0xffcc3300, 0xff993300, 0xff663300, 0xff333300, 0xff003300, 0xffcc0000, 0xff990000,
        0xff660000, 0xff330000, 0xff0000ee, 0xff0000dd, 0xff0000bb, 0xff0000aa, 0xff000077, 0xff000044, 0xff00ee00,
        0xff00dd00, 0xff00bb00, 0xff00aa00, 0xff007700, 0xff004400, 0xffee0000, 0xffdd0000, 0xffbb0000, 0xffaa0000,
        0xff770000, 0xff440000, 0xffeeeeee, 0xffdddddd, 0xffbbbbbb, 0xffaaaaaa, 0xff888888, 0xff777777, 0xff555555,
        0xff444444, 0xff222222, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t palette_3[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xffffffff, 0xff0a0140, 0xff221f33, 0xff100067, 0xff2900ff, 0xff180094, 0xff130071, 0xff18008c,
        0xff2100bd, 0xff3a364d, 0xff2900e7, 0xff2300c6, 0xff2100b5, 0xff2900de, 0xff180081, 0xff2900d6, 0xff2100ad,
        0xff200495, 0xff3100f9, 0xff2900ce, 0xff2100a5, 0xff3208da, 0xff2900c6, 0xff3f0ff7, 0xff3100e8, 0xff5120fe,
        0xff0f013f, 0xff7645f8, 0xff0b0222, 0xffa873fa, 0xffcdc9d1, 0xfffeb3fe, 0xffff8bfd, 0xffff60ed, 0xff31002a,
        0xff3d0034, 0xff31202e, 0xff26001f, 0xff94217b, 0xffbd299c, 0xfffb57d5, 0xffb52994, 0xffde31b5, 0xfff43ec8,
        0xfffd4ad2, 0xff76185f, 0xff99307f, 0xffa52184, 0xffd631ad, 0xffad298c, 0xff783c69, 0xff84216b, 0xffe052bc,
        0xff8c2170, 0xffce31a5, 0xffa32d84, 0xffc6299c, 0xff9c217b, 0xffd631aa, 0xffed3abd, 0xffe239b5, 0xff611b4e,
        0xffbd2994, 0xffe739b7, 0xffde31ad, 0xffc6329c, 0xff942173, 0xffb5298c, 0xffd631a5, 0xfff877d1, 0xff8c216b,
        0xffad2984, 0xff8c868a, 0xffff00a6, 0xffce0084, 0xff60003d, 0xfff7009c, 0xffe60091, 0xffc6007d, 0xff8f005a,
        0xffad006c, 0xffa50067, 0xff9a0060, 0xff7d004e, 0xff500032, 0xffb90073, 0xffd10081, 0xffd60084, 0xff870052,
        0xff720045, 0xff550033, 0xff46002a, 0xff8e848a, 0xff35001f, 0xffff0c9a, 0xff802d5b, 0xffd5147d, 0xff681842,
        0xffd23384, 0xffff3399, 0xff622d47, 0xffc66b95, 0xffb7b1b3, 0xffaa9b9c, 0xfff58785, 0xff461b16, 0xff8c3921,
        0xff662a18, 0xffd65a31, 0xffac4928, 0xff777473, 0xffe76336, 0xffde6339, 0xffb54d29, 0xffc65229, 0xffdd5f33,
        0xffce5a31, 0xfff97344, 0xff9f4221, 0xff783219, 0xffc0522b, 0xffee6a3a, 0xff84391d, 0xfffb7d4d, 0xffbd5229,
        0xff984221, 0xff944221, 0xffde6331, 0xffa54b23, 0xffff905e, 0xffc3c1c0, 0xfffe9d6c, 0xfffeba88, 0xfffee0af,
        0xffdfdedb, 0xfffff8c8, 0xffccc030, 0xffdeded6, 0xff00c000, 0xff00a500, 0xff009c00, 0xff009700, 0xff009400,
        0xff008c00, 0xff008400, 0xff007b00, 0xff007300, 0xff006b00, 0xff006300, 0xff003f00, 0xff03b303, 0xff05aa05,
        0xff10c610, 0xff25ce25, 0xff42fc42, 0xff4bed4b, 0xff399139, 0xff68ff68, 0xff88fb88, 0xff7b937b, 0xff949594,
        0xff2de32e, 0xff005e01, 0xff1e3a25, 0xff9c9f9d, 0xff0cbb51, 0xffa3aea9, 0xff05ea99, 0xff00ffa5, 0xff004a38,
        0xff1e6657, 0xff00ffce, 0xff008074, 0xff2faea9, 0xff053e3d, 0xff62ffff, 0xffb3ffff, 0xff31f9ff, 0xff001718,
        0xff005d69, 0xff85dae5, 0xff00a3bb, 0xff09ddfd, 0xff0094ad, 0xff00bdde, 0xff1cddff, 0xff00c6ea, 0xff00b5d6,
        0xff00adce, 0xff007b93, 0xff00a5c6, 0xff009cbc, 0xff008ca9, 0xff00819c, 0xff0093b2, 0xff256573, 0xff09cbf6,
        0xff02b8e2, 0xff00738e, 0xff00667e, 0xff08c6f3, 0xff009dc3, 0xff0093b8, 0xff0084a7, 0xff00252f, 0xff687275,
        0xff0099ff, 0xff0e4062, 0xff474d52, 0xff637a97, 0xff0066ff, 0xff000061, 0xff00002d, 0xffffffff, 0xffefefef,
        0xffeeeeee, 0xffe7e7e7, 0xffdddddd, 0xffbbbbbb, 0xffadadad, 0xffaaaaaa, 0xff888888, 0xff848484, 0xff777777,
        0xff6b6b6b, 0xff636363, 0xff5a5a5a, 0xff555555, 0xff525252, 0xff4a4a4a, 0xff444444, 0xff424242, 0xff343434,
        0xff313131, 0xff2980ff, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t palette_4[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xff018080, 0xff525252, 0xff810080, 0xffeeeeee, 0xffcfe6e9, 0xffe7e7e7, 0xffdedede, 0xffdedddd,
        0xffd1d5d3, 0xffcecfcc, 0xffc3ded5, 0xffd2d9da, 0xffccebd0, 0xffc1c7c5, 0xffa3c8c0, 0xffb4bbbf, 0xffcbc6b7,
        0xffb5b5b5, 0xffa9e1b3, 0xffc4bdaf, 0xffacaeae, 0xff9cb2ad, 0xffaab1ab, 0xffa5a3a3, 0xff95949e, 0xffb4ad9a,
        0xff909395, 0xff84957f, 0xff384c47, 0xff424246, 0xff5a7370, 0xff677d63, 0xff6d8f81, 0xff5f7c78, 0xff686b6f,
        0xffa59a92, 0xff91896b, 0xff797360, 0xff90a191, 0xff7b8f8f, 0xff8c908c, 0xff434552, 0xff5b5966, 0xff848484,
        0xff949494, 0xff767376, 0xff4e4a49, 0xff465652, 0xff8e9c9d, 0xff4e4243, 0xff756a63, 0xff7aadaf, 0xff457e7b,
        0xff509d93, 0xff729fa3, 0xff4f899d, 0xff85c5cf, 0xff8dd1cc, 0xff1790ac, 0xff446663, 0xff214e50, 0xff556968,
        0xff066370, 0xff187098, 0xff004781, 0xff09565b, 0xff00465f, 0xff4ccccc, 0xff28b2e3, 0xff0091a7, 0xff56b7d4,
        0xff025cd1, 0xff00397c, 0xff002545, 0xff002b72, 0xff413e93, 0xff002172, 0xff18185b, 0xff1514b8, 0xff040e87,
        0xff00166c, 0xff001063, 0xff0012a1, 0xff000c52, 0xff000837, 0xff161831, 0xff000021, 0xff00002a, 0xff43485c,
        0xff1b3c58, 0xff3f3e73, 0xffafa492, 0xff7b9c98, 0xff828282, 0xff766744, 0xff464947, 0xff4b3939, 0xff798881,
        0xff9c9c9c, 0xff69887e, 0xff329097, 0xffabdbda, 0xff645a5a, 0xff5a5a5a, 0xff425048, 0xff5f5137, 0xff292938,
        0xff5a504b, 0xff606363, 0xff655a45, 0xff5f4142, 0xff664e4c, 0xff354042, 0xff43392b, 0xff252b2a, 0xff5f7757,
        0xff727c6e, 0xff97af9c, 0xff797b80, 0xff8c8d8b, 0xff6b7671, 0xff4d6a57, 0xff5a6f47, 0xff354b39, 0xff37392c,
        0xff4d4d36, 0xff4a4231, 0xffca9a96, 0xffa57c71, 0xff4b5a5b, 0xff84745a, 0xff676363, 0xff785453, 0xffb3827c,
        0xff9d5a5d, 0xff915659, 0xff8f705c, 0xff5b2830, 0xff553f2a, 0xffaa1f2a, 0xffff1f2a, 0xff422424, 0xff551f2a,
        0xff55002a, 0xff3b0519, 0xff392121, 0xff583335, 0xff4a3643, 0xff463131, 0xff3e1821, 0xff291014, 0xff6d3e42,
        0xff82d1a6, 0xffc6c6c6, 0xff96bcbd, 0xffbfbfbf, 0xff9bcca8, 0xff78ea7b, 0xff42a115, 0xff53d400, 0xff42b900,
        0xff2b9000, 0xff125304, 0xff23481c, 0xff1d844c, 0xff298100, 0xff1e6700, 0xff47945c, 0xff4d5748, 0xff4a6c45,
        0xff033130, 0xff004122, 0xff024843, 0xff3d673b, 0xff204837, 0xff0c3b09, 0xff1c351a, 0xff263533, 0xff2b2b2b,
        0xff012532, 0xff768a6f, 0xff353537, 0xff33512c, 0xff363125, 0xff1f4529, 0xff0c2606, 0xff001800, 0xff35282a,
        0xff212222, 0xff31281f, 0xff18211e, 0xff1e291d, 0xff001f2a, 0xff04211d, 0xff19161d, 0xff142d1c, 0xff251e1b,
        0xff191919, 0xff0f1419, 0xff001419, 0xff181818, 0xff000014, 0xff111111, 0xff040c11, 0xff21080c, 0xff1e1410,
        0xff101010, 0xff0e100c, 0xff001000, 0xff140808, 0xff080808, 0xff000808, 0xff0a0403, 0xff000204, 0xff000c6e,
        0xff7e9e98, 0xff000856, 0xff000548, 0xff000538, 0xff000022, 0xff586f6b, 0xff4a5c59, 0xff525756, 0xff404f4e,
        0xff4a4a4a, 0xff3b4642, 0xff424242, 0xff3d4039, 0xff3b3942, 0xff2f393e, 0xffaa573d, 0xff734738, 0xff5c352d,
        0xff533129, 0xff4a3121, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t palette_5[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xffccffff, 0xff99ffff, 0xff66ffff, 0xff33ffff, 0xffffccff, 0xffccccff, 0xff99ccff, 0xff66ccff,
        0xff33ccff, 0xff00ccff, 0xffff99ff, 0xffcc99ff, 0xff9999ff, 0xff6699ff, 0xff3399ff, 0xff0099ff, 0xffff66ff,
        0xffcc66ff, 0xff9966ff, 0xff6666ff, 0xff3366ff, 0xff0066ff, 0xffff33ff, 0xffcc33ff, 0xff9933ff, 0xff6633ff,
        0xff3333ff, 0xff0033ff, 0xffcc00ff, 0xff9900ff, 0xff6600ff, 0xff3300ff, 0xffffffcc, 0xffccffcc, 0xff99ffcc,
        0xff66ffcc, 0xff33ffcc, 0xff00ffcc, 0xffffcccc, 0xffcccccc, 0xff99cccc, 0xff66cccc, 0xff33cccc, 0xff00cccc,
        0xffff99cc, 0xffcc99cc, 0xff9999cc, 0xff6699cc, 0xff3399cc, 0xff0099cc, 0xffff66cc, 0xffcc66cc, 0xff9966cc,
        0xff6666cc, 0xff3366cc, 0xff0066cc, 0xffff33cc, 0xffcc33cc, 0xff9933cc, 0xff6633cc, 0xff3333cc, 0xff0033cc,
        0xffff00cc, 0xffcc00cc, 0xff9900cc, 0xff6600cc, 0xff3300cc, 0xff0000cc, 0xffffff99, 0xffccff99, 0xff99ff99,
        0xff66ff99, 0xff33ff99, 0xff00ff99, 0xffffcc99, 0xffcccc99, 0xff99cc99, 0xff66cc99, 0xff33cc99, 0xff00cc99,
        0xffff9999, 0xffcc9999, 0xff999999, 0xff669999, 0xff339999, 0xff009999, 0xffff6699, 0xffcc6699, 0xff996699,
        0xff666699, 0xff336699, 0xff006699, 0xffff3399, 0xffcc3399, 0xff993399, 0xff663399, 0xff333399, 0xff003399,
        0xffff0099, 0xffcc0099, 0xff990099, 0xff660099, 0xff330099, 0xff000099, 0xffffff66, 0xffccff66, 0xff99ff66,
        0xff66ff66, 0xff33ff66, 0xff00ff66, 0xffffcc66, 0xffcccc66, 0xff99cc66, 0xff66cc66, 0xff33cc66, 0xff00cc66,
        0xffff9966, 0xffcc9966, 0xff999966, 0xff669966, 0xff339966, 0xff009966, 0xffff6666, 0xffcc6666, 0xff996666,
        0xff666666, 0xff336666, 0xff006666, 0xffff3366, 0xffcc3366, 0xff993366, 0xff663366, 0xff333366, 0xff003366,
        0xffff0066, 0xffcc0066, 0xff990066, 0xff660066, 0xff330066, 0xff000066, 0xffffff33, 0xffccff33, 0xff99ff33,
        0xff66ff33, 0xff33ff33, 0xff00ff33, 0xffffcc33, 0xffcccc33, 0xff99cc33, 0xff66cc33, 0xff33cc33, 0xff00cc33,
        0xffff9933, 0xffcc9933, 0xff999933, 0xff669933, 0xff339933, 0xff009933, 0xffff6633, 0xffcc6633, 0xff996633,
        0xff666633, 0xff336633, 0xff006633, 0xffff3333, 0xffcc3333, 0xff993333, 0xff663333, 0xff333333, 0xff003333,
        0xffff0033, 0xffcc0033, 0xff990033, 0xff660033, 0xff330033, 0xff000033, 0xffccff00, 0xff99ff00, 0xff66ff00,
        0xff33ff00, 0xffffcc00, 0xffcccc00, 0xff99cc00, 0xff66cc00, 0xff33cc00, 0xff00cc00, 0xffff9900, 0xffcc9900,
        0xff999900, 0xff669900, 0xff339900, 0xff009900, 0xffff6600, 0xffcc6600, 0xff996600, 0xff666600, 0xff336600,
        0xff006600, 0xffff3300, 0xffcc3300, 0xff993300, 0xff663300, 0xff333300, 0xff003300, 0xffcc0000, 0xff990000,
        0xff660000, 0xff330000, 0xff0000ee, 0xff0000dd, 0xff0000bb, 0xff0000aa, 0xff000077, 0xff000044, 0xff00ee00,
        0xff00dd00, 0xff00bb00, 0xff00aa00, 0xff007700, 0xff004400, 0xffee0000, 0xffdd0000, 0xffbb0000, 0xffaa0000,
        0xff770000, 0xff440000, 0xffeeeeee, 0xffdddddd, 0xffbbbbbb, 0xffaaaaaa, 0xff888888, 0xff777777, 0xff555555,
        0xff444444, 0xff222222, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t palette_6[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xfff8f8f8, 0xfffffef0, 0xfff4f8f7, 0xfffceff7, 0xffefefef, 0xffefefe7, 0xffe7efe7, 0xffe9eedd,
        0xffe8e7e8, 0xff01fdff, 0xff7ce9f1, 0xffeef0b6, 0xffdededd, 0xff3ee8ff, 0xffd6d7d6, 0xfffac1f3, 0xff08deff,
        0xfffbf575, 0xff70e8b1, 0xffd5c5d0, 0xffbcc7c8, 0xffcbc3c6, 0xff41f690, 0xff28d9d2, 0xff41baff, 0xfffbff32,
        0xff0bf799, 0xff02d9d7, 0xffb7c1ab, 0xff31acfc, 0xffb6a3db, 0xffb4b5b2, 0xffefff0a, 0xffffff02, 0xff31a5ef,
        0xffb0c188, 0xfffbcf4c, 0xff0ba9ed, 0xffaeabac, 0xffbfea29, 0xffe5aa98, 0xffeff005, 0xff3aa5d4, 0xffaab584,
        0xff9d9eb4, 0xffdedf08, 0xffc8e108, 0xffd672dd, 0xff9b9d9c, 0xff86b17b, 0xff37be77, 0xffc8df00, 0xffa0a878,
        0xff12ab99, 0xff97928c, 0xff22c258, 0xffaacf00, 0xff879c70, 0xff83c61e, 0xff8c8e81, 0xfffb9b39, 0xffde9e3b,
        0xff1e7dba, 0xff84887b, 0xff175cf9, 0xffd46c94, 0xff28a85a, 0xff6d8b6f, 0xff85ba00, 0xff7b7b7a, 0xffb5903a,
        0xff695eb8, 0xff82a02c, 0xff2c9957, 0xff82943f, 0xffbda605, 0xff7a8856, 0xfffc9801, 0xff209651, 0xffff8518,
        0xff9fa002, 0xffff8410, 0xff3d805d, 0xffd034b9, 0xff726874, 0xff218c4a, 0xff7fa000, 0xff3f31f1, 0xff6f6e67,
        0xfffd8407, 0xff197f62, 0xffff7a14, 0xff0da518, 0xfff77618, 0xffbf752e, 0xff778823, 0xff949400, 0xffaf556d,
        0xff616862, 0xff218146, 0xff799400, 0xff62714d, 0xffe67610, 0xff317b48, 0xff8c8c00, 0xff7c6e3e, 0xff333db8,
        0xff7b8c00, 0xff177e40, 0xff98702a, 0xff738c00, 0xffe16b12, 0xff848500, 0xff7b8400, 0xff738400, 0xff5c5a5b,
        0xff606a39, 0xff6b8400, 0xff598700, 0xff386842, 0xffd06313, 0xffca2888, 0xff737b03, 0xff2611ed, 0xff216a3f,
        0xff6b7b00, 0xff667212, 0xff7b7209, 0xff166b3b, 0xff545351, 0xff8c611e, 0xff527b00, 0xff9e3c5e, 0xff12506a,
        0xff3a476d, 0xff586f12, 0xff637600, 0xff737201, 0xff6b7300, 0xff555837, 0xffb82b69, 0xff487302, 0xff241bbb,
        0xff703a61, 0xffc43b3e, 0xff566f00, 0xff6b6b00, 0xff484d45, 0xff636b00, 0xff94394f, 0xff316b10, 0xff7f3d4c,
        0xff4a6b01, 0xff155e2d, 0xffc04c10, 0xff394c3c, 0xff605718, 0xff474e2f, 0xff465d11, 0xff525a11, 0xff5d5f00,
        0xff434241, 0xff85314a, 0xff335c13, 0xff904d0d, 0xff426100, 0xff613646, 0xff194640, 0xff4a5c00, 0xff7a3142,
        0xff525900, 0xff124f2a, 0xff1f119a, 0xff454f10, 0xff44373c, 0xff86420c, 0xff374d12, 0xff39383a, 0xff313d31,
        0xff5f3135, 0xff3c3c2c, 0xff5c3f19, 0xff4a4f00, 0xff154c19, 0xff424c00, 0xff364d00, 0xff7b203f, 0xff3e3a1d,
        0xff313131, 0xff5d3a0d, 0xff313621, 0xff832e0f, 0xff394202, 0xff273522, 0xff314204, 0xff463909, 0xff0f3a1a,
        0xff294200, 0xff1c1067, 0xff5c310a, 0xff5d1937, 0xff3c242d, 0xff393803, 0xff28262b, 0xff27360a, 0xff551d29,
        0xff313603, 0xff103808, 0xff293600, 0xff21291b, 0xff5c240d, 0xff0e3800, 0xff213400, 0xff2c231c, 0xff212121,
        0xff42260b, 0xff421b20, 0xff12231c, 0xff212118, 0xff400f2e, 0xff2d230c, 0xff1e240c, 0xff181821, 0xff21181a,
        0xff212400, 0xff352000, 0xff181818, 0xff182400, 0xff050c36, 0xff3e0e1b, 0xff0b1e0c, 0xff2d1019, 0xff34140c,
        0xff1b180c, 0xff0f1c00, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t palette_7[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xfff8f8f8, 0xfffffef0, 0xfff4f8f7, 0xfffceff7, 0xffefefef, 0xffefefe7, 0xffe7efe7, 0xffe9eedd,
        0xffe8e7e8, 0xff01fdff, 0xff7ce9f1, 0xffeef0b6, 0xffdededd, 0xff3ee8ff, 0xffd6d7d6, 0xfffac1f3, 0xff08deff,
        0xff004b00, 0xff70e8b1, 0xffd5c5d0, 0xffbcc7c8, 0xffcbc3c6, 0xff41f690, 0xff28d9d2, 0xff41baff, 0xff0464dc,
        0xff0bf799, 0xff02d9d7, 0xffb7c1ab, 0xff31acfc, 0xffb6a3db, 0xffb4b5b2, 0xff004eb6, 0xff003173, 0xff31a5ef,
        0xffb0c188, 0xff001839, 0xff0ba9ed, 0xffaeabac, 0xffbfea29, 0xffe5aa98, 0xff518ffc, 0xff3aa5d4, 0xffaab584,
        0xff9d9eb4, 0xffdedf08, 0xff010000, 0xffd672dd, 0xff9b9d9c, 0xff86b17b, 0xff37be77, 0xffc8df00, 0xffa0a878,
        0xff12ab99, 0xff97928c, 0xff22c258, 0xffaacf00, 0xff879c70, 0xff83c61e, 0xff8c8e81, 0xfffb9b39, 0xff003797,
        0xff1e7dba, 0xff84887b, 0xff175cf9, 0xffd46c94, 0xff28a85a, 0xff6d8b6f, 0xff85ba00, 0xff7b7b7a, 0xffb5903a,
        0xff695eb8, 0xff82a02c, 0xff2c9957, 0xff82943f, 0xffbda605, 0xff7a8856, 0xfffc9801, 0xff209651, 0xffff8518,
        0xff9fa002, 0xffff8410, 0xff3d805d, 0xffd034b9, 0xff726874, 0xff218c4a, 0xff7fa000, 0xff3f31f1, 0xff6f6e67,
        0xfffd8407, 0xff197f62, 0xffff7a14, 0xff0da518, 0xfff77618, 0xffbf752e, 0xff778823, 0xff949400, 0xffaf556d,
        0xff616862, 0xff218146, 0xff799400, 0xff62714d, 0xffe67610, 0xff317b48, 0xff8c8c00, 0xff7c6e3e, 0xff333db8,
        0xff7b8c00, 0xff177e40, 0xff98702a, 0xff738c00, 0xffe16b12, 0xff848500, 0xff7b8400, 0xff738400, 0xff5c5a5b,
        0xff606a39, 0xff6b8400, 0xff598700, 0xff386842, 0xffd06313, 0xffca2888, 0xff737b03, 0xff2611ed, 0xff216a3f,
        0xff6b7b00, 0xff667212, 0xff7b7209, 0xff166b3b, 0xff545351, 0xff8c611e, 0xff527b00, 0xff9e3c5e, 0xff12506a,
        0xff3a476d, 0xff586f12, 0xff637600, 0xff737201, 0xff6b7300, 0xff555837, 0xffb82b69, 0xff487302, 0xff241bbb,
        0xff703a61, 0xffc43b3e, 0xff566f00, 0xff6b6b00, 0xff484d45, 0xff636b00, 0xff94394f, 0xff316b10, 0xff7f3d4c,
        0xff4a6b01, 0xff155e2d, 0xffc04c10, 0xff394c3c, 0xff605718, 0xff474e2f, 0xff465d11, 0xff525a11, 0xff5d5f00,
        0xff434241, 0xff85314a, 0xff335c13, 0xff904d0d, 0xff426100, 0xff613646, 0xff194640, 0xff4a5c00, 0xff7a3142,
        0xff525900, 0xff124f2a, 0xff1f119a, 0xff454f10, 0xff44373c, 0xff86420c, 0xff374d12, 0xff39383a, 0xff313d31,
        0xff5f3135, 0xff3c3c2c, 0xff5c3f19, 0xff4a4f00, 0xff154c19, 0xff424c00, 0xff331b1d, 0xff7b203f, 0xff3e3a1d,
        0xff313131, 0xff5d3a0d, 0xff313621, 0xff832e0f, 0xff394202, 0xff273522, 0xff314204, 0xff463909, 0xff002b06,
        0xff294200, 0xff1c1067, 0xff5c310a, 0xff5d1937, 0xff3c242d, 0xff393803, 0xff28262b, 0xff27360a, 0xff551d29,
        0xff313603, 0xff103808, 0xff293600, 0xff21291b, 0xff5c240d, 0xff0e3800, 0xff213400, 0xffff198f, 0xff4b2d7d,
        0xff003cc7, 0xff3a37b9, 0xff7831ab, 0xfff500c3, 0xffbd14a6, 0xff4cbbff, 0xff369ff3, 0xff2599ff, 0xff1f96ff,
        0xff0c7be4, 0xff1355b1, 0xff3a2d66, 0xff0a2268, 0xff005be3, 0xffeb00b9, 0xffe27c61, 0xff53c42f, 0xff57b048,
        0xff48b129, 0xff3c9723, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t palette_8[] = {
        0x00000000, 0xff000080, 0xff008000, 0xff008080, 0xff800000, 0xff800080, 0xff808000, 0xffc0c0c0, 0xffc0dcc0,
        0xfff0caa6, 0xffeeeeee, 0xffacf0ff, 0xffcae7ff, 0xffb2eeea, 0xffb9deff, 0xffedd2ff, 0xffe2e4dd, 0xffffff9c,
        0xffc6d6ff, 0xffd2d2ff, 0xff7ae3fc, 0xff1ef1ff, 0xffede7c5, 0xffa9d6ff, 0xff00f4ff, 0xff9cceff, 0xff46e8ea,
        0xffa5f2b2, 0xff1debed, 0xff1ddbff, 0xffd5d0ce, 0xff91c6f9, 0xffb9bbff, 0xffa5d0dc, 0xff4cfba8, 0xffccc2e2,
        0xff7fff7f, 0xffa2c1e8, 0xff6ed5cf, 0xff00e1dd, 0xff34f697, 0xff1bc4f6, 0xffa5a5ff, 0xfff0f546, 0xffffc49e,
        0xffcdce9c, 0xffbfbdbc, 0xff00c3f3, 0xff73b1ec, 0xfff7f721, 0xff1dbde3, 0xff4eff4e, 0xffed8df1, 0xff86a3eb,
        0xff47b4dd, 0xffdfd163, 0xff00c6c1, 0xffdbb880, 0xff1ab6c5, 0xffa499cb, 0xff29cf8b, 0xff00c1b2, 0xff4d86fb,
        0xffffa973, 0xff1cff1c, 0xff1f8bfe, 0xffd2e607, 0xff26cb7a, 0xff65af96, 0xff7284e4, 0xff309ccc, 0xff9bb279,
        0xff7373ff, 0xff009bd4, 0xffb6bb48, 0xff6990b7, 0xff01ff00, 0xff00a9a4, 0xff1c76fe, 0xffa4be3c, 0xff979096,
        0xff35cf3d, 0xff1978e6, 0xff00f000, 0xff006eff, 0xff4a78cc, 0xffff9452, 0xff0c6bfa, 0xff8e8b89, 0xff1481c0,
        0xffd88868, 0xff8c73ad, 0xff007ad0, 0xff1daa63, 0xff008da3, 0xff9c9c4a, 0xff00aa64, 0xff7270ab, 0xff98a631,
        0xff4a4aff, 0xff5c8388, 0xffe0a311, 0xffff873b, 0xff557595, 0xff72728c, 0xff00ce00, 0xff8e678f, 0xff0044f9,
        0xff5c6791, 0xff2437fd, 0xff754dad, 0xff0049df, 0xff158d51, 0xfffd15e7, 0xff776d6b, 0xff0067a1, 0xff356493,
        0xffff7623, 0xff408c3b, 0xff7b2ddf, 0xffd96938, 0xff1847c1, 0xff46617b, 0xffd13b8f, 0xff007667, 0xff2121ff,
        0xff4c6367, 0xff00a500, 0xff8c428c, 0xffb56b29, 0xff0029eb, 0xff5921d6, 0xffff670b, 0xff6b34a5, 0xff843c84,
        0xffbd2994, 0xffaa2f8f, 0xffb716b4, 0xff1c10f7, 0xffff6300, 0xff00429e, 0xff8f6328, 0xff16664c, 0xffe75d0f,
        0xff008f00, 0xff52613c, 0xff0b0bff, 0xff773877, 0xff27339c, 0xff59cccc, 0xffda521c, 0xffa9287e, 0xff296b29,
        0xfff35a00, 0xffb44c2c, 0xff8a238c, 0xffad5a0f, 0xff714b42, 0xffd04a21, 0xff634c45, 0xff9d4b31, 0xff9b2974,
        0xff4f4b4c, 0xff0000fc, 0xffc52172, 0xff7e4a39, 0xff591aa4, 0xff191db3, 0xff24671d, 0xff176329, 0xff007b00,
        0xff94296b, 0xff2c3a6d, 0xff0000eb, 0xffb54e0f, 0xff1d3872, 0xffd64f00, 0xff5a3069, 0xffe1018e, 0xff414344,
        0xff0018a9, 0xff00386a, 0xff7b295a, 0xff4e00b8, 0xff006c00, 0xff0000d3, 0xff135f10, 0xffa34b02, 0xff89421c,
        0xffd13b0f, 0xff93166b, 0xff6b2952, 0xffb14100, 0xff222c5a, 0xff0000bd, 0xff44039e, 0xff7b0e72, 0xffa82631,
        0xff522948, 0xff00364c, 0xff6e3b15, 0xff65008c, 0xff0000b1, 0xff39009c, 0xff2f3439, 0xffa73803, 0xff18343d,
        0xff3f3036, 0xff522939, 0xff403f14, 0xff5a0084, 0xff104b0a, 0xff0000a2, 0xff005200, 0xff2e028c, 0xff442e27,
        0xff003329, 0xff372928, 0xff00008c, 0xff54006d, 0xff7f2e00, 0xff002148, 0xff292929, 0xff25056d, 0xff4a1242,
        0xff18212c, 0xff2f0d3c, 0xff211c21, 0xff1f2908, 0xff69180e, 0xff001638, 0xff000063, 0xff110f3e, 0xff003100,
        0xff13121b, 0xff3e1502, 0xff340622, 0xff000039, 0xff10120d, 0xff004200, 0xffffcf9c, 0xffb5a3ff, 0xffff9900,
        0xffb5ffde, 0xff6bfaba, 0xff010000, 0xfff0fbff, 0xffa4a0a0, 0xff808080, 0xff0000ff, 0xff00ff00, 0xff00ffff,
        0xffff0000, 0xffff00ff, 0xffffff00, 0xffffffff
};

static const uint32_t *palette[] = {
        palette_1, palette_2, palette_3, palette_4, palette_5, palette_6, palette_7, palette_8
};

// ---------------------------------------------------------------------------
char *libsrf_raw_to_bmp(uint16_t *data, size_t width, size_t height, size_t *bmp_size, int palette_idx) {
    int bpp = 4; // bytes/pixel
    uint32_t line_width = width * bpp;
    size_t x, y;

    if (bpp == 3) {
        line_width = ((uint32_t) ((width * 3 + 3) / 4)) * 4;
    }
    BMPHeader *header = (BMPHeader *) calloc(sizeof(BMPHeader) + line_width * height * bpp, 1);
    if (header == NULL) {
        return NULL;
    }

    char *bmp = (char *) (header + 1);
    memset(bmp, 0xFF, line_width * height * bpp);

    header->header[0] = 'B';
    header->header[1] = 'M';
    header->pos = 54;
    header->header_len = 40;
    header->width = width;
    header->height = height;
    header->layers = 1;
    header->depth = bpp * 8;
    header->data_len = line_width * height * bpp;
    header->filesize = header->data_len + header->pos;

    const uint32_t *p = palette[palette_idx];

    for (y = 0; y < height; y++) {
        for (x = 0; x < width; x++) {
            int idx = data[x + y * width] & 0xff;
            uint32_t color = ((p[idx] & 0xff) << 16) | (p[idx] & 0xff00) |
                             ((p[idx] >> 16) & 0xff);
            color |= (~(data[x + y * width] >> 8) << 24);
            int byte_pos = (height - y - 1) * line_width + x * bpp;
            bmp[byte_pos] = color & 0xff;
            bmp[byte_pos + 1] = (color >> 8) & 0xff;
            bmp[byte_pos + 2] = (color >> 16) & 0xff;
            bmp[byte_pos + 3] = (color >> 24) & 0xff;
        }
    }

    *bmp_size = sizeof(BMPHeader) + line_width * height * bpp;
    return (char *) header;
}

// ---------------------------------------------------------------------------
char *libsrf_raw_to_png(uint16_t *data, size_t width, size_t height, size_t *png_size, int palette_idx) {
    size_t x, y;
    libattopng_t *png = libattopng_new(width, height, PNG_PALETTE);
    libattopng_set_palette(png, (uint32_t *) palette[palette_idx], 256);

    for (y = 0; y < height; y++) {
        for (x = 0; x < width; x++) {
            int idx = data[x + y * width] & 0xff;
            libattopng_set_pixel(png, x, y, idx);
        }
    }
    char *png_data = libattopng_get_data(png, png_size);
    char *img = (char *) malloc(*png_size);
    memcpy(img, png_data, *png_size);
    libattopng_destroy(png);
    return img;
}