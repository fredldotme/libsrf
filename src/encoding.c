#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include "encoding.h"
#include "cstring.h"

static const uint16_t upper_encoding[] = {
        0x84c3, 0x80c4, 0x81c4, 0x89c3, 0x84c4, 0x96c3, 0x9cc3, 0xa1c3, 0x85c4, 0x8cc4, 0xa4c3, 0x8dc4, 0x86c4, 0x87c4,
        0xa9c3, 0xb9c5, 0xbac5, 0x8ec4, 0xadc3, 0x8fc4, 0x92c4, 0x93c4, 0x96c4, 0xb3c3, 0x97c4, 0xb4c3, 0xb6c3, 0xb5c3,
        0xbac3, 0x9ac4, 0x9bc4, 0xbcc3, 0x80e2, 0xb0c2, 0xaec2, 0xa3c2, 0xa7c2, 0x80e2, 0xb6c2, 0x9fc3, 0xaec2, 0xa9c2,
        0x84e2, 0x99c4, 0xa8c2, 0x89e2, 0xa3c4, 0xaec4, 0xafc4, 0xaac4, 0x89e2, 0x89e2, 0xabc4, 0xb6c4, 0x9fc3, 0x9fc3,
        0x82c5, 0xbbc4, 0xbcc4, 0xbdc4, 0xbec4, 0xb9c4, 0xbac4, 0x85c5, 0x86c5, 0x83c5, 0xacc2, 0x9fc3, 0x84c5, 0x87c5,
        0x9fc3, 0xabc2, 0xbbc2, 0x80e2, 0xa0c2, 0x88c5, 0x90c5, 0x95c3, 0x91c5, 0x8cc5, 0x80e2, 0x80e2, 0x80e2, 0x80e2,
        0x80e2, 0x80e2, 0xb7c3, 0x97e2, 0x8dc5, 0x94c5, 0x95c5, 0x98c5, 0x80e2, 0x80e2, 0x99c5, 0x96c5, 0x97c5, 0xa0c5,
        0x80e2, 0x80e2, 0xa1c5, 0x9ac5, 0x9bc5, 0x81c3, 0xa4c5, 0xa5c5, 0x8dc3, 0xbdc5, 0xbec5, 0xaac5, 0x93c3, 0x94c3,
        0xabc5, 0xaec5, 0x9ac3, 0xafc5, 0xb0c5, 0xb1c5, 0xb2c5, 0xb3c5, 0x9dc3, 0xbdc3, 0xb7c4, 0xbbc5, 0x81c5, 0xbcc5,
        0xa2c4, 0x87cb};

#if 0
string toHTML(unsigned char *in, int length) {

    int i;
    for (i = 0; i < length; i++) {
        if (in[i] == 0x7b) input += "";
        else if (in[i] == 0xb7) input += "&szlig;";
        else if (in[i] == 0xa2) input += "&reg;";
        else if (in[i] == 0xab) input += "'";
        else if (in[i] >= 0x80) input += string(encoding[in[i] - 0x80]);
        else input += string(1, in[i]);
    }

    return input;
}
#endif


// ---------------------------------------------------------------------------
char *libsrf_encoding_to_utf8(char *string) {
    unsigned char *str = (unsigned char *) string;
    char *utf = libsrf_cstring_create();
    int i, len = strlen(string);
    for (i = 0; i < len; i++) {
        if (str[i] == 0x7b) {
            continue;
        }
        else if (str[i] >= 0x80) {
            utf = libsrf_cstring_append_unicode(utf, upper_encoding[str[i] - 0x80]);
        } else {
            utf = libsrf_cstring_append_char(utf, str[i]);
        }
    }

    return libsrf_cstring_move_to_char(utf);
}

// ---------------------------------------------------------------------------
char *libsrf_encoding_move_to_utf8(char *str) {
    char *utf = libsrf_encoding_to_utf8(str);
    free(str);
    return utf;
}